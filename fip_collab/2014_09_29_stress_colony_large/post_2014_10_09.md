---
layout: post
title: "Comparison of MKS Prediction to CPFEM Response for Hexagonal Polycrystals"
author: Noah Paulson, Matthew Priddy

latex: true

field_compare_mks_cpfem_e11_v1:
  type: img
  src: "https://farm4.staticflickr.com/3862/15071355547_ba7c7cd027_o.png"
hist_compare_mks_cpfem_e11_v1:
  type: img
  src: "https://farm6.staticflickr.com/5582/15071237800_603611931f_b.jpg"
ori_hex_cal:
  type: img
  src: "https://farm6.staticflickr.com/5560/15257527362_5535d4099c_o.png"
error_violin_chart:
  type: img
  src: "https://farm3.staticflickr.com/2946/15401040782_07fd32733b_o.png"
ori_hex_val:
  type: img
  src: "https://farm4.staticflickr.com/3908/15257926485_075ee210fe_o.png"
fip_SA_cycle_graphic:
  type: img
  src: "https://farm4.staticflickr.com/3889/15318192311_2dd9f52b03_o.png"
error_in_mks_prediction_for_stress_components:
  type: img
  src: "https://farm4.staticflickr.com/3910/15134418087_b8d72529f1_o.png"
error_in_mks_prediction_cycle_min_max:
  type: img
  src: "https://farm6.staticflickr.com/5576/15134418057_47dff3af9b_o.png"
error_violin_sigmaVM_50val_no_abs:
  type: img
  src: "https://farm4.staticflickr.com/3931/15378358216_6ac00bb473_o.png"
field_step1_comp9_1val51el:
  type: img
  src: "https://farm6.staticflickr.com/5601/15489896925_1f9e7d1728_o.png"

---

## Introduction

The goal of this study is to demonstrate the capability of the MKS to accurately predict stress and strain fields in the alpha-Titanium materials system. First, the MKS is calibrated for the $$\epsilon_{11}$$ strain component, then the MKS is calibrated for all of the components of the stress tensor for each of 6 steps of cyclic loading (as in the CPFEM simulations).

## CPFEM Simulations

Crystal Plasticity Finite Element Method (CPFEM) simulations were performed to 0.5% strain amplitude over three cycles. The simulation results used in this study are from the first loading segment.

* Microstructure size: 21 x 21 x 21
* Material: Polycrystalline Titanium, alpha phase
* Microstructure type: orientations randomly assigned to voxels in microstructure
* Element Type: C3D8 (strain value in each voxel averaged over all integration points)

## MKS Prediction

The materials knowledge system (MKS) was used to predict the elastic response of alpha-Ti polycrystalline microstructures. The MKS was calibrated using a set of 200 microstructures and the associated CPFEM stress and strain fields. Validation was performed using a set of 50 microstructures and the associated CPFEM stress and strain fields. 

### Calibration Datasets

Two-hundred Calibration microstructures were generated by randomly assigning voxels orientations selected from a pre-determined list of orientations. These orientations were selected from the $$ \phi2 = 0 $$ face of the hexagonal fundamental zone, where $$ 0 \leq \phi1 \leq 2\pi $$ and $$ 0 \leq \Phi \leq \frac{\pi}{2} $$. The selection of this face for calibration is appropriate as the $$ \phi2 $$ angle has no effect on elastic properties. In addition, the $$ \phi2 $$ angle does not influence the coefficients generated by the GSH Hexagonal-Triclinic formulation when L = 4. A relatively small set of 96 orientations were selected in order to increase the proportion of high-contrast (in orientation) voxel pairings in the calibration microstructures.

_The image below shows the orientations selected for microstructures in the calibration data-set_

{% include ContentManager.html content=page.ori_hex_cal %}

The choice to calibrate with 200 samples was justified through a study comparing the error in validation versus the number of samples used for calibration. The image below is a violin plot showing the error distribution in the validation versus CPFEM results for calibration sets ranging from 20 to 500 samples in size. The red bar in each "violin" is the mean error in von-Mises stress between the MKS prediction and CPFEM response. The thickness of each "violin" at any error level represents the frequency with which that error occurs.

{% include ContentManager.html content=page.error_violin_chart %}

### Validation Datasets

Fifty Validation microstructures were generated by assigning voxels orientations randomly from the hexagonal-triclinic fundamental zone ($$ 0 \leq \phi1 \leq 2\pi $$, $$ 0 \leq \Phi \leq \frac{\pi}{2} $$, $$ 0 \leq \phi2 \leq \frac{\pi}{3} $$).

_The image below shows orientations assigned to voxels of microstructures in the validation data-set_

{% include ContentManager.html content=page.ori_hex_val %}

## Results

### Calibration for the $$\epsilon_{11}$$ strain component 

The MKS calibration and subsequent validation were successfully performed.

* Mean Absolute Strain Error (MASE) = 0.102%
* Mean maximum error over all microstructures =  0.529%
* Maximum error in any microstructure = 0.753%
* Mean minimum $$\epsilon_{11}$$, CPFEM: 0.00462
* Mean minimum $$\epsilon_{11}$$, MKS: 0.00460
* Average $$\epsilon_{11}$$, CPFEM: 0.00499
* Average $$\epsilon_{11}$$, MKS: 0.00499
* Mean maximum $$\epsilon_{11}$$, CPFEM: 0.00526
* Mean maximum $$\epsilon_{11}$$, MKS: 0.00525

_The image below shows a comparison of the $$\epsilon_{11}$$ strain fields between the MKS prediction and the CPFEM result for a single slice of a single validation microstructure_

{% include ContentManager.html content=page.field_compare_mks_cpfem_e11_v1 %}

_The histogram below shows a comparison of the $$\epsilon_{11}$$ between the MKS prediction and the CPFEM result_

{% include ContentManager.html content=page.hist_compare_mks_cpfem_e11_v1 %}

### Stress Tensor Calibration for time-steps 1 through 6

The MKS calibration and subsequent validation were successfully performed for the full stress tensor (all components) over each step in the cyclic loading (steps 1 - 6)

_The image below details the steps in the cyclic loading_

{% include ContentManager.html content=page.fip_SA_cycle_graphic %}

_The graph below shows the error in the MKS prediction of the CPFEM stress fields during the first loading step_

{% include ContentManager.html content=page.error_in_mks_prediction_for_stress_components %}

Three error measures are used; each is a measure of the difference in stress between identical voxels in the CPFEM results and the MKS prediction, divided by the mean von-Mises stress in the CPFEM response. This is in comparison to the error definitions in the strain calibration section, where the voxel difference was normalized by the CPFEM strain in the current voxel. The current error definition was chosen to allow for the comparison of errors between components, even when the stress values of certain components may be near zero. These three types of errors are detailed below. 

1. Mean Error: The error averaged over all voxels in all 50 validation microstructures
2. Average Maximum Error: The average of the maximum error (on a voxel by voxel basis) seen in each validation microstructure
3. Absolute Maximum Error: The maximum error value seen in any voxel in any of the validation microstructures

_The graph below shows the difference in average maximum error between the minimum and maximum (i.e. step 1 vs step 2) locations in the cyclic loading_ 

{% include ContentManager.html content=page.error_in_mks_prediction_cycle_min_max %}

The reason these errors can be plotted this way is because the errors in each of the maximums and minimums are nearly identical to each other. In all cases the cycle minimum had a higher error than the cycle maximum.

This final violin plot shows the error distributions for 15 bins of the von-Mises stress response, which range from the minimum to the maximum stresses in all voxels in the validation samples.

{% include ContentManager.html content=page.error_violin_sigmaVM_50val_no_abs %}


## Zero-Padding for the Prediction of Large Microstructures

Next, the influence coefficients from the previous calibration for stress were zero padded and the response fields were predicted for some larger microstructures.

The following image compares the $$\sigma_{vm}$$ stress fields between the MKS prediction and CPFEM response of a 39x39x39 element microstructure. The microstructure was composed of 3x3x3 element 'grains' each with a randomly assigned orientation from the hexagonal fundamental zone (this particular structure was chosen for computational reasons).

{% include ContentManager.html content=page.field_step1_comp9_1val51el %}

The errors are slightly higher with zero-padding (Mean error = 0.74%, Max error = 3.94%), but the response fields remain nearly identical in appearance.

## Conclusions

The MKS was successfully calibrated and shown to predict the elastic (+ minimal plastic) response of random-grain polycrystalline alpha titanium to a high degree of accuracy.

### Next Steps

* Calibrate the MKS to predict the response of realistic alpha-beta titanium microstructures
	* Select appropriate set of microstructures for calibration
* Streamline the computations and analyze the efficiency of those computations.
	* Pay particular interest in the comparison with CPFEM computational efficiency.

### References

* Y.C. Yabansu, D.K. Patel, S.R. Kalidindi _Calibrated localization relationships for elastic response of polycrystalline aggregates_ Acta Materialia 81 (2014) 151-160
